\subsection{Position}

\[
\mathbf{e}_5 = \mathbf{x}_{ref} - \mathbf{x}
\]

\[
\dot{\mathbf{e}}_5 = \dot{\mathbf{x}}_{ref} - \dot{\mathbf{x}}
\]

\[
\dot{\mathbf{e}}_5 = \dot{\mathbf{x}}_{ref} - \mathbf{v}
\]

\[
\mathbf{v}_{ref} = \mathbf{C}_5 \mathbf{e}_5 + \dot{\mathbf{x}}_{ref} + \boldsymbol\Lambda_5 \boldsymbol\chi_5
\]

\[
\dot{\mathbf{v}}_{ref} = \mathbf{C}_5 \dot{\mathbf{e}}_5 + \ddot{\mathbf{x}}_{ref} + \boldsymbol\Lambda_5 \mathbf{e}_5
\]


\[
\mathbf{e}_6 = \mathbf{v}_{ref} - \mathbf{v}
\]

\[
\mathbf{e}_6 = \mathbf{C}_5 \mathbf{e}_5 + \dot{\mathbf{x}}_{ref} + \boldsymbol\Lambda_5 \boldsymbol\chi_5 - \mathbf{v}
\]

\[
\dot{\mathbf{e}}_6 = \dot{\mathbf{v}}_{ref} - \dot{\mathbf{v}} = \Vd{v}_{ref} - \V{a}
\]

\[
\dot{\mathbf{e}}_6 = \mathbf{C}_5 \dot{\mathbf{e}}_5 + \ddot{\mathbf{x}}_{ref} + \boldsymbol\Lambda_5 \mathbf{e}_5 - \ddot{\mathbf{x}}
\]

\[
\dot{\mathbf{x}}_{ref} = \mathbf{v}_{ref} - \mathbf{C}_5 \mathbf{e}_5 - \boldsymbol\Lambda_5 \boldsymbol\chi_5
\]

\[
\dot{\mathbf{x}}_{ref} = \mathbf{e}_6 + \mathbf{v} - \mathbf{C}_5 \mathbf{e}_5 - \boldsymbol\Lambda_5 \boldsymbol\chi_5
\]

\[
\dot{\mathbf{e}}_5 = \mathbf{e}_6 - \mathbf{C}_5 \mathbf{e}_5 - \boldsymbol\Lambda_5 \boldsymbol\chi_5
\]

\[
\dot{\mathbf{e}}_6 = \mathbf{f}_6(\mathbf{e}_5,\mathbf{e}_6)
\]

\[
\mathbf{f}_6(\mathbf{e}_5,\mathbf{e}_6)
= \mathbf{C}_5 \left( \mathbf{e}_6 - \mathbf{C}_5 \mathbf{e}_5 - \boldsymbol\Lambda_5 \boldsymbol\chi_5 \right)
+ \ddot{\mathbf{x}}_{ref}
+ \boldsymbol\Lambda_5 \mathbf{e}_5
- \ddot{\mathbf{x}}
\]

\[
\Vdd{x}
= -\mathbf{f}_6(\mathbf{e}_5,\mathbf{e}_6)
+ \mathbf{C}_5 \left( \mathbf{e}_6 - \mathbf{C}_5 \mathbf{e}_5 - \boldsymbol\Lambda_5 \boldsymbol\chi_5 \right)
+ \ddot{\mathbf{x}}_{ref}
+ \boldsymbol\Lambda_5 \mathbf{e}_5
\]

\[
\mathbf{F}_{R}
= m \left(
	-\mathbf{C}_7 \mathbf{e}_5 - \mathbf{C}_8 \mathbf{e}_6
	+ \mathbf{C}_5 \left( \mathbf{e}_6 - \mathbf{C}_5 \mathbf{e}_5 - \boldsymbol\Lambda_5 \boldsymbol\chi_5 \right)
	+ \ddot{\mathbf{x}}_{ref}
	+ \boldsymbol\Lambda_5 \mathbf{e}_5
	- \mathbf{g}
	- \frac{1}{m} \mathbf{F}_{D}
\right)
\]

\[
\mathbf{F}_{R}
= m \left(
	\left( -\mathbf{C}_7 - \mathbf{C}_5^2 + \boldsymbol\Lambda_5\right) \mathbf{e}_5 +
	\left( \mathbf{C}_8 + \mathbf{C}_5 \right) \mathbf{e}_6 
	- \mathbf{C}_5 \boldsymbol\Lambda_5 \boldsymbol\chi_5
	+ \ddot{\mathbf{x}}_{ref}
	- \mathbf{g}
	- \frac{1}{m} \mathbf{F}_{D}
\right)
\]

\begin{align}\nonumber
\mathbf{F}_{R}
= m \left( \right. & \left( -\mathbf{C}_7 - \mathbf{C}_5^2 + \boldsymbol\Lambda_5 \right) \mathbf{e}_5 \\\nonumber
	+ &\left( -\mathbf{C}_8 + \mathbf{C}_5 \right) \left( \mathbf{C}_5 \mathbf{e}_5 + \dot{\mathbf{x}}_{ref} + \boldsymbol\Lambda_5 \boldsymbol\chi_5 - \mathbf{v}\right) \\\nonumber
	- &\left. \mathbf{C}_5 \boldsymbol\Lambda_5 \boldsymbol\chi_5
	+ \ddot{\mathbf{x}}_{ref}
	- \mathbf{g}
	- \frac{1}{m} \mathbf{F}_{D}
\right)
\end{align}

\begin{align}\nonumber
\frac{1}{m} \mathbf{F}_{R}
= & \left( -\mathbf{C}_7 - \mathbf{C}_5^2 + \boldsymbol\Lambda_5 + \left( -\mathbf{C}_8 + \mathbf{C}_5 \right) \mathbf{C}_5 \right) \mathbf{x}_{ref} \\\nonumber
- &\left( -\mathbf{C}_7 - \mathbf{C}_5^2 + \boldsymbol\Lambda_5 + \left( -\mathbf{C}_8 + \mathbf{C}_5 \right) \mathbf{C}_5 \right) \mathbf{x} \\\nonumber
+ &\left( -\mathbf{C}_8 + \mathbf{C}_5 \right) \dot{\mathbf{x}}_{ref} \\\nonumber
+ &\left( -\mathbf{C}_8 \right) \boldsymbol\Lambda_5 \boldsymbol\chi_5 \\\nonumber
- &\left( -\mathbf{C}_8 + \mathbf{C}_5 \right) \mathbf{v} \\\nonumber
+ &\ddot{\mathbf{x}}_{ref} - \mathbf{g} - \frac{1}{m} \mathbf{F}_{D}
\end{align}

\begin{align}\nonumber
0 = + &~ \mathbf{C}_{11} \boldsymbol\chi_5 \\\nonumber
+ &~ \mathbf{C}_9 (\mathbf{x}_{ref} - \mathbf{x}) \\\nonumber
+ &~ \mathbf{C}_{10} (\dot{\mathbf{x}}_{ref} - \mathbf{v}) \\\nonumber
+ &~ \Vdd{x}_{ref} - \Vdd{x}
\end{align}

\subsection{Dynamics of Acceleration}

Instead of assuming $\Vdd{x}$ is our control input, we can continue the above process. We guess that the result will be

\begin{align}\nonumber
0 = + &~ \mathbf{C}_{9} \boldsymbol\chi_5 \\\nonumber
+ &~ \mathbf{C}_{10} (\mathbf{x}_{ref} - \mathbf{x}) \\\nonumber
+ &~ \mathbf{C}_{11} (\dot{\mathbf{x}}_{ref} - \mathbf{v}) \\\nonumber
+ &~ \V{C}_{12} ( \Vdd{x}_{ref} - \V{a} ) \\\nonumber
+ &~ \Vddd{x}_{ref} - \Vd{a}
\end{align}

\[
\V{a} = \V{a}_{g} + \V{a}_{R}
\]

\[
\Vd{a} = \Vd{a}_{R}
\]

\[
\V{a}_R = \V{q}^* \V{a}_{RB} \V{q}
\]

In general, if q rotates from y to x frame

\[
\V{y} = \V{q}^* \V{x} \V{q}
\]

\[
\Vd{y} = \Vd{q}^* \V{x} \V{q} + \V{q}^* \Vd{x} \V{q} + \V{q}^* \V{x} \Vd{q}
\]

\[
\Vd{y} = \V{q}^* \G{\omega}^* \V{x} \V{q} + \V{q}^* \Vd{x} \V{q} + \V{q}^* \V{x} \G{\omega} \V{q}
\]

\[
\Vd{y} = \V{q}^* \left( \G{\omega}^* \V{x} + \Vd{x} + \V{x} \G{\omega} \right) \V{q}
\]

\[
\V{q} \Vd{y} \V{q}^* = \G{\omega}^* \V{x} + \Vd{x} + \V{x} \G{\omega}
\]

In our case



\[
\V{a}_{RB} = \begin{bmatrix} 0 \\ 0 \\ a_{RB} \\ 0 \end{bmatrix}
\]

which leads to the simple result

\[
\G{\omega}^* \V{x} + \Vd{x} + \V{x} \G{\omega} = 
\begin{bmatrix}
0 \\
- \omega_y a_{RB} \\
\omega_x a_{RB} \\
\dot{a}_{RB}
\end{bmatrix}
\]

Notice that $\omega_z$ does not appear because it has no effect on the translation of the vehicle.
In order to solve for $\omega_x$, $\omega_y$, and $a_{RB}$, we need a relationship between $a_{RB}$ and its derivative.
For example, we could use forward differencing.



\subsubsection{Transfer Function}

\begin{align}\nonumber
	\ddot{x} = \left( \right. & c_9 y - c_9 x + c_{10} \dot{y} - c_{10} \dot{x} \\\nonumber
	& + c_{11} \int y - c_{11} \int x \\\nonumber
	& + \left. \ddot{y} - g - \frac{F_D}{m} \right)
\end{align}


\begin{align}\nonumber
	s^2 X - s x(0) - \dot{x}(0) = \left( \right. & c_9 Y - c_9 X \\\nonumber
	& + c_{10} sY - c_{10} y(0) - c_{10} sX + c_{10} x(0) \\\nonumber
	& + c_{11} \frac{Y}{s} - c_{11} \int x \\\nonumber
	& + \left. \ddot{y} - g - \frac{F_D}{m} \right)
\end{align}







